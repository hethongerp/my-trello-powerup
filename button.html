<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
  <style>
    body { font-family: sans-serif; padding: 10px; }
    button { margin-left: 8px; padding: 4px 8px; background: #0052cc; color: white; border: none; cursor: pointer; }
    div { margin-bottom: 6px; }
  </style>
</head>
<body>
  <h3>üìù Checklist c·ªßa th·∫ª</h3>
  <div id="list"></div>

  <script>
    const t = window.TrelloPowerUp.iframe();

    async function load() {
      try {
        const card = await t.card('id', 'name', 'checklists');
        const listEl = document.getElementById('list');
        listEl.innerHTML = '';

        if (!card.checklists || !card.checklists.length) {
          listEl.innerHTML = '<i>Kh√¥ng c√≥ checklist n√†o</i>';
          return;
        }

        card.checklists.forEach(cl => {
          const title = document.createElement('h4');
          title.innerText = 'üìã ' + cl.name;
          listEl.appendChild(title);

          cl.checkItems.forEach(item => {
            const div = document.createElement('div');
            div.innerHTML = `
              <span>${item.state === 'complete' ? '‚úÖ' : '‚¨ú'} ${item.name}</span>
              <button data-id="${item.id}">ü™Ñ Chi ti·∫øt</button>
            `;
            div.querySelector('button').onclick = () => {
              t.popup({
                title: `Chi ti·∫øt: ${item.name}`,
                url: t.signUrl('https://my-trello-powerup.vercel.app/popup.html', { 
                  itemId: item.id, 
                  itemName: item.name 
                }),
                height: 300,
                args: { itemId: item.id, itemName: item.name }
              });
            };
            listEl.appendChild(div);
          });
        });
      } catch (error) {
        console.error('Error loading checklists:', error);
        listEl.innerHTML = '<i>L·ªói khi t·∫£i checklist</i>';
      }
    }

    t.render(load);
  </script>
</body>
</html>
